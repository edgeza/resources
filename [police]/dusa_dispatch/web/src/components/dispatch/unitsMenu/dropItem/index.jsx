import s from "./style.module.scss"
import { useDroppable } from "@dnd-kit/core"
import { useLanguage } from "../../../../hooks/useLanguage"
import { useData } from "../../../../hooks/useData"

function UnitsDrop({ item, deleteItem, settings }) {
  const { isOver, setNodeRef } = useDroppable({
    id: item.dropId,
    data: item.dropId,
  })
  const dropId = item.dropId
  const { language } = useLanguage()
  const { data } = useData()
  const getColor = (job) => {
    if (!data.dispatch.jobColor[job]) return "white"
    return data.dispatch.jobColor[job]
  }
  const hexToRgb = (hex) => {
    if (!hex) return "255,255,255"
    const r = parseInt(hex.slice(1, 3), 16)
    const g = parseInt(hex.slice(3, 5), 16)
    const b = parseInt(hex.slice(5, 7), 16)

    return ` rgb(${r},${g},${b}, 0.17)`
  }
  return (
    <div
      className={`${s.body} ${isOver && s.activeDrop} ${data.dispatch.job === "police" ? s.police : s.ambulance}`}
      ref={setNodeRef}
    >
      <div className={s.header}>
        <div className={s.id}>{item.name}</div>
        <div className={`${s.time} ${item.userList.length >= item.maxCount && s.maxCount}`}>
          {item.userList.length}/{item.maxCount}
        </div>
        <div
          className={s.settings}
          onClick={() => {
            settings(item)
          }}
          style={{ display: !data.dispatch.jobAcces.unitsEdit && "none" }}
        >
          <svg xmlns="http://www.w3.org/2000/svg" width="15" height="16" viewBox="0 0 15 16" fill="none">
            <path
              d="M13.4999 8.23394C13.5027 8.13302 13.5027 8.03211 13.4999 7.9312L14.5455 6.62494C14.6003 6.55636 14.6383 6.47585 14.6563 6.38992C14.6743 6.30398 14.6719 6.21502 14.6492 6.13019C14.4775 5.486 14.2211 4.86742 13.8868 4.29064C13.8429 4.21518 13.7821 4.15098 13.7091 4.10317C13.6361 4.05536 13.553 4.02525 13.4663 4.01523L11.804 3.83022C11.7349 3.75734 11.6648 3.68726 11.5938 3.61999L11.3976 1.95353C11.3875 1.86678 11.3573 1.78359 11.3093 1.71059C11.2614 1.63759 11.1971 1.5768 11.1215 1.53306C10.5447 1.19896 9.92614 0.943037 9.28193 0.772013C9.1971 0.749349 9.10814 0.746928 9.0222 0.764942C8.93626 0.782957 8.85576 0.820905 8.78718 0.875728L7.48442 1.91569C7.38351 1.91569 7.2826 1.91569 7.18169 1.91569L5.87543 0.872224C5.80684 0.817401 5.72634 0.779453 5.64041 0.761439C5.55447 0.743424 5.46551 0.745845 5.38068 0.768509C4.73648 0.940219 4.11791 1.1966 3.54113 1.53096C3.46566 1.57478 3.40147 1.6356 3.35366 1.7086C3.30585 1.7816 3.27573 1.86474 3.26572 1.95143L3.08071 3.61649C3.00783 3.6861 2.93775 3.75617 2.87048 3.82672L1.20402 4.01803C1.11727 4.02813 1.03408 4.05834 0.961079 4.10628C0.888078 4.15422 0.827286 4.21855 0.78355 4.29414C0.44952 4.871 0.193375 5.48956 0.0218 6.13369C-0.00076731 6.21858 -0.00307548 6.30757 0.0150615 6.39351C0.0331985 6.47945 0.0712732 6.55992 0.126216 6.62844L1.16618 7.9312C1.16618 8.03211 1.16618 8.13302 1.16618 8.23394L0.122713 9.54019C0.0678893 9.60878 0.0299416 9.68928 0.0119268 9.77522C-0.00608797 9.86115 -0.00366634 9.95012 0.0189968 10.0349C0.190707 10.6791 0.447093 11.2977 0.781447 11.8745C0.825264 11.95 0.886092 12.0141 0.959088 12.062C1.03208 12.1098 1.11523 12.1399 1.20192 12.1499L2.86417 12.3349C2.93378 12.4078 3.00386 12.4779 3.07441 12.5451L3.26852 14.2116C3.27861 14.2984 3.30883 14.3815 3.35677 14.4545C3.40471 14.5275 3.46904 14.5883 3.54463 14.6321C4.12149 14.9661 4.74005 15.2222 5.38418 15.3938C5.46906 15.4164 5.55806 15.4187 5.644 15.4006C5.72994 15.3824 5.81041 15.3443 5.87893 15.2894L7.18169 14.2494C7.2826 14.2522 7.38351 14.2522 7.48442 14.2494L8.79068 15.295C8.85927 15.3498 8.93977 15.3878 9.0257 15.4058C9.11164 15.4238 9.2006 15.4214 9.28543 15.3987C9.92973 15.2273 10.5483 14.9709 11.125 14.6363C11.2004 14.5925 11.2646 14.5316 11.3125 14.4586C11.3603 14.3856 11.3904 14.3025 11.4004 14.2158L11.5854 12.5536C11.6583 12.4844 11.7284 12.4143 11.7956 12.3433L13.4621 12.1471C13.5488 12.137 13.632 12.1068 13.705 12.0589C13.778 12.0109 13.8388 11.9466 13.8826 11.871C14.2166 11.2941 14.4727 10.6756 14.6443 10.0314C14.6669 9.94656 14.6692 9.85756 14.651 9.77162C14.6329 9.68569 14.5948 9.60521 14.5399 9.53669L13.4999 8.23394ZM7.33306 10.8857C6.77865 10.8857 6.23669 10.7213 5.77572 10.4133C5.31475 10.1053 4.95547 9.66748 4.7433 9.15528C4.53114 8.64307 4.47563 8.07946 4.58379 7.5357C4.69195 6.99195 4.95892 6.49248 5.35094 6.10046C5.74297 5.70843 6.24244 5.44146 6.78619 5.3333C7.32995 5.22514 7.89356 5.28065 8.40577 5.49282C8.91797 5.70498 9.35576 6.06426 9.66377 6.52523C9.97178 6.9862 10.1362 7.52816 10.1362 8.08257C10.1362 8.826 9.84085 9.53899 9.31516 10.0647C8.78948 10.5904 8.07649 10.8857 7.33306 10.8857Z"
              fill="#CECECE"
            />
          </svg>
        </div>
      </div>
      <div className={s.dropArea}>
        {item.userList.map((item, index) => {
          return (
            <div
              key={index}
              style={{
                backgroundColor: hexToRgb(getColor(item.job)),
              }}
              className={s.userItem}
            >
              <div style={{ backgroundColor: getColor(item.job) }} className={s.boder}></div>
              <div className={s.userText}>
                <h3 style={{ color: getColor(item.job) }}>{item.name}</h3>
                <p style={{ color: getColor(item.job) }}>{item.jobRank}</p>
              </div>
              {data.dispatch.jobAcces.unitsEdit && (
                <div className={s.circle} style={{ color: getColor(item.job) }} onClick={() => deleteItem(item, dropId)}>
                  X
                </div>
              )}
            </div>
          )
        })}
      </div>
    </div>
  )
}

export default UnitsDrop
