import s from "./style.module.scss"
import { useLanguage } from "../../../../hooks/useLanguage"
import { useData } from "../../../../hooks/useData"
import { useState } from "react"
import { useDraw } from "../../../../hooks/useDraw"
import { motion } from "framer-motion"
import { postNui } from "../../../../utils/postNui"
import { useNotify } from "../../../../hooks/notify"
function ManagaCamera() {
  const [search, setSearch] = useState("")
  const { data, setData } = useData()
  const { map } = useDraw()
  const { language } = useLanguage()
  const cameraList = data.dispatch.cameraList

  const handleSearch = (e) => {
    setSearch(e.target.value)
  }
  const getCamList = () => {
    return cameraList.filter((cam) =>
      cam.name.toLowerCase().includes(search.toLowerCase())
    )
  }
  const handleDelete = (id, camId) => {
    useNotify(language.deleteCamera)
    setData({
      ...data,
      dispatch: {
        ...data.dispatch,
        cameraList: data.dispatch.cameraList.filter(
          (cam) => cam.id !== id
        ),
      },
    })
    postNui("deleteCamera", {id: id, camid: camId})
  }
  const handleLocation = (position) => {
    postNui("pointCamera", {coords: position})
  }
  const handleConnect = (cam, index) => {
    postNui("connectCamera", {id: cam.id, camId: cam.camId, index: index + 1})
  }
  const handleSelect = (item) => {
    // find camera in dispatch list
    if(item.active){
      let newList = data.dispatch.cameraList.map((cam) => {
        cam.active = false
        return cam
      })
      setData((prev) => ({
        ...prev,
        dispatch: {
          ...prev.dispatch,
          cameraList: newList,
        },
      }))
      return
    }
    let newList = data.dispatch.cameraList.map((cam) => {
      if (cam.camİd === item.camİd) {
        cam.active = true
      } else {
        cam.active = false
      }
      return cam
    })
    setData((prev) => ({
      ...prev,
      dispatch: {
        ...prev.dispatch,
        cameraList: newList,
      },
    }))
    map.current.setView(item.position, 5)
  }
  return (
    <motion.div
      initial={{ opacity: 0 }}
      animate={{ opacity: 1 }}
      exit={{ opacity: 0 }}
      className={s.body}
    >
      <div className={s.header}>
        <h3> {language.cameraList} </h3>
        <p> {language.cameraListDesc} </p>
      </div>
      <div className={s.main}>
        <div className={s.search}>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="19"
            height="20"
            viewBox="0 0 19 20"
            fill="none"
          >
            <path
              d="M13.1535 8.54516C13.1535 9.55685 12.8535 10.5458 12.2914 11.387C11.7293 12.2282 10.9304 12.8838 9.99575 13.271C9.06106 13.6582 8.03256 13.7595 7.04031 13.5621C6.04805 13.3647 5.1366 12.8775 4.42123 12.1622C3.70585 11.4468 3.21867 10.5353 3.0213 9.54309C2.82393 8.55083 2.92523 7.52233 3.31239 6.58765C3.69954 5.65296 4.35518 4.85407 5.19637 4.29201C6.03756 3.72994 7.02654 3.42994 8.03824 3.42994C9.39488 3.42994 10.696 3.96886 11.6552 4.92815C12.6145 5.88744 13.1535 7.18852 13.1535 8.54516ZM18.7857 19.2926C18.7178 19.3605 18.6372 19.4144 18.5485 19.4512C18.4598 19.488 18.3647 19.5069 18.2687 19.5069C18.1726 19.5069 18.0776 19.488 17.9888 19.4512C17.9001 19.4144 17.8195 19.3605 17.7517 19.2926L13.179 14.719C11.5888 16.042 9.54987 16.701 7.48621 16.5589C5.42256 16.4169 3.4931 15.4847 2.09918 13.9564C0.705254 12.428 -0.0458263 10.4212 0.00216607 8.35318C0.0501584 6.2852 0.893528 4.31532 2.35685 2.85329C3.82017 1.39126 5.79079 0.549634 7.85882 0.503469C9.92684 0.457304 11.9331 1.21016 13.4602 2.60543C14.9873 4.00071 15.9177 5.93099 16.0579 7.99476C16.1982 10.0585 15.5374 12.0969 14.213 13.686L18.7857 18.2586C18.8536 18.3265 18.9075 18.4071 18.9443 18.4958C18.9811 18.5845 19 18.6796 19 18.7756C19 18.8716 18.9811 18.9667 18.9443 19.0554C18.9075 19.1441 18.8536 19.2247 18.7857 19.2926ZM8.03824 15.1219C9.33899 15.1219 10.6105 14.7362 11.6921 14.0135C12.7736 13.2908 13.6166 12.2637 14.1143 11.062C14.6121 9.86022 14.7423 8.53786 14.4886 7.26211C14.2348 5.98635 13.6084 4.81449 12.6887 3.89472C11.7689 2.97495 10.597 2.34858 9.32129 2.09481C8.04553 1.84105 6.72317 1.97129 5.52144 2.46907C4.3197 2.96684 3.29256 3.8098 2.5699 4.89133C1.84724 5.97287 1.46152 7.24441 1.46152 8.54516C1.46345 10.2888 2.15698 11.9605 3.38993 13.1935C4.62289 14.4264 6.29458 15.1199 8.03824 15.1219Z"
              fill="#959595"
            />
          </svg>
          <input
            type="text"
            onChange={handleSearch}
            value={search}
            placeholder={language.searchCamera}
          />
        </div>
        <div className={s.camList}>
          {getCamList().map((cam, i) => (
            <div key={i} className={s.camItem}>
              <div className={s.left}
              onClick={()=> handleSelect(cam)}
              >
                <div className={s.icon}>
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="25"
                    height="21"
                    viewBox="0 0 25 21"
                    fill="none"
                  >
                    <path
                      d="M24.2187 12.4933C24.0115 12.4933 23.8128 12.5756 23.6663 12.7221C23.5198 12.8686 23.4375 13.0673 23.4375 13.2745V14.837H19.0732L17.2851 13.046L22.2011 8.12898C22.494 7.83598 22.6584 7.43871 22.6584 7.02448C22.6584 6.61025 22.494 6.21298 22.2011 5.91998L18.5214 2.23928L16.7294 0.451184C16.5843 0.306053 16.4121 0.190927 16.2225 0.112382C16.0329 0.0338356 15.8297 -0.0065918 15.6244 -0.0065918C15.4192 -0.0065918 15.216 0.0338356 15.0264 0.112382C14.8368 0.190927 14.6645 0.306053 14.5194 0.451184L0.284952 14.7335C0.148694 14.8702 0.0559925 15.0442 0.0185522 15.2335C-0.0188882 15.4229 0.000611995 15.6191 0.0745903 15.7973C0.148569 15.9756 0.273708 16.1279 0.434206 16.2351C0.594704 16.3423 0.783365 16.3995 0.976364 16.3996H4.82112L8.27037 19.8478C8.56337 20.1406 8.96064 20.3051 9.37487 20.3051C9.7891 20.3051 10.1864 20.1406 10.4794 19.8478L16.1777 14.1534L17.9687 15.9415C18.1133 16.0873 18.2854 16.2028 18.475 16.2814C18.6646 16.3601 18.8679 16.4002 19.0732 16.3996H23.4375V17.9621C23.4375 18.1693 23.5198 18.368 23.6663 18.5145C23.8128 18.661 24.0115 18.7433 24.2187 18.7433C24.4259 18.7433 24.6247 18.661 24.7712 18.5145C24.9177 18.368 25 18.1693 25 17.9621V13.2745C25 13.0673 24.9177 12.8686 24.7712 12.7221C24.6247 12.5756 24.4259 12.4933 24.2187 12.4933ZM15.6249 1.55569L16.8642 2.79495L4.82112 14.837H2.38849L15.6249 1.55569Z"
                      fill="white"
                    />
                  </svg>
                </div>
                <div className={s.camInfo}>
                  <h3> {cam.name} </h3>
                  <p> {cam.adress} </p>
                </div>
              </div>
              <div className={s.right}>
                <div className={s.camButton}>
                  <div
                    className={s.delete}
                    style={{ display: !data.dispatch.jobAcces.editCamera && "none" }}
                    onClick={() => handleDelete(cam.id, cam.camİd)}
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="28"
                      height="28"
                      viewBox="0 0 28 28"
                      fill="none"
                    >
                      <rect
                        x="0.148653"
                        y="0.148653"
                        width="27.5232"
                        height="27.5232"
                        rx="2.8244"
                        fill="#FF3939"
                        fillOpacity="0.17"
                      />
                      <rect
                        x="0.148653"
                        y="0.148653"
                        width="27.5232"
                        height="27.5232"
                        rx="2.8244"
                        stroke="#FF3939"
                        strokeWidth="0.297305"
                      />
                      <path
                        d="M19.0769 10.2671C19.0769 10.3901 19.0281 10.508 18.9411 10.595C18.8542 10.6819 18.7362 10.7308 18.6133 10.7308H18.1496V19.0769C18.1496 19.3229 18.0519 19.5588 17.878 19.7327C17.7041 19.9066 17.4682 20.0043 17.2222 20.0043H9.80343C9.55748 20.0043 9.32161 19.9066 9.1477 19.7327C8.97378 19.5588 8.87608 19.3229 8.87608 19.0769V10.7308H8.41241C8.28943 10.7308 8.17149 10.6819 8.08454 10.595C7.99758 10.508 7.94873 10.3901 7.94873 10.2671C7.94873 10.1441 7.99758 10.0262 8.08454 9.93924C8.17149 9.85228 8.28943 9.80343 8.41241 9.80343H18.6133C18.7362 9.80343 18.8542 9.85228 18.9411 9.93924C19.0281 10.0262 19.0769 10.1441 19.0769 10.2671ZM11.1945 8.87608H15.8312C15.9542 8.87608 16.0721 8.82723 16.1591 8.74027C16.246 8.65332 16.2949 8.53538 16.2949 8.41241C16.2949 8.28943 16.246 8.17149 16.1591 8.08454C16.0721 7.99758 15.9542 7.94873 15.8312 7.94873H11.1945C11.0715 7.94873 10.9535 7.99758 10.8666 8.08454C10.7796 8.17149 10.7308 8.28943 10.7308 8.41241C10.7308 8.53538 10.7796 8.65332 10.8666 8.74027C10.9535 8.82723 11.0715 8.87608 11.1945 8.87608Z"
                        fill="#FF3939"
                      />
                    </svg>
                  </div>
                  <div
                    className={s.location}
                    onClick={() => handleLocation(cam.position)}
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="29"
                      height="28"
                      viewBox="0 0 29 28"
                      fill="none"
                    >
                      <rect
                        x="0.738496"
                        y="0.148653"
                        width="27.5232"
                        height="27.5232"
                        rx="2.8244"
                        fill="#FFBC39"
                        fillOpacity="0.17"
                      />
                      <rect
                        x="0.738496"
                        y="0.148653"
                        width="27.5232"
                        height="27.5232"
                        rx="2.8244"
                        stroke="#FFBC39"
                        strokeWidth="0.297305"
                      />
                      <path
                        d="M21.3583 13.0086C21.3569 13.2041 21.2927 13.394 21.1751 13.5502C21.0575 13.7064 20.8928 13.8207 20.7054 13.8761L20.6938 13.8796L16.1828 15.1427L14.9197 19.6537L14.9162 19.6652C14.8607 19.8527 14.7464 20.0173 14.5902 20.1349C14.4341 20.2524 14.2442 20.3167 14.0487 20.3182H14.0314C13.8397 20.32 13.6523 20.2613 13.4959 20.1505C13.3394 20.0398 13.2218 19.8825 13.1598 19.7011L9.3868 9.5288C9.38558 9.5258 9.38461 9.52271 9.38391 9.51955C9.32752 9.35578 9.31823 9.17948 9.35709 9.0107C9.39595 8.84191 9.4814 8.68742 9.60372 8.5648C9.72604 8.44218 9.88032 8.35635 10.049 8.31707C10.2177 8.2778 10.394 8.28666 10.5579 8.34264L10.5672 8.34553L20.7412 12.1197C20.9254 12.1827 21.0847 12.3029 21.1957 12.4629C21.3067 12.6228 21.3637 12.814 21.3583 13.0086Z"
                        fill="#FFBC39"
                      />
                    </svg>
                  </div>
                  <div
                    className={s.connect}
                    onClick={() => handleConnect(cam, i)}
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="28"
                      height="28"
                      viewBox="0 0 28 28"
                      fill="none"
                    >
                      <rect
                        x="0.32834"
                        y="0.148653"
                        width="27.5232"
                        height="27.5232"
                        rx="2.8244"
                        fill="#1FA2EC"
                        fillOpacity="0.17"
                      />
                      <rect
                        x="0.32834"
                        y="0.148653"
                        width="27.5232"
                        height="27.5232"
                        rx="2.8244"
                        stroke="#1FA2EC"
                        strokeWidth="0.297305"
                      />
                      <path
                        d="M11.575 8.13924C11.5285 8.02405 11.5296 7.89511 11.5782 7.78077C11.6268 7.66644 11.7188 7.57607 11.834 7.52957C11.9491 7.48306 12.0781 7.48421 12.1924 7.53277C12.3068 7.58134 12.3971 7.67333 12.4436 7.78852L12.9113 8.95759C12.9343 9.01462 12.9459 9.07564 12.9453 9.13714C12.9448 9.19865 12.9321 9.25944 12.908 9.31606C12.884 9.37267 12.849 9.42399 12.8052 9.46709C12.7613 9.51019 12.7093 9.54423 12.6523 9.56726C12.5953 9.59029 12.5343 9.60186 12.4728 9.60131C12.4112 9.60076 12.3505 9.5881 12.2938 9.56405C12.2372 9.54001 12.1859 9.50505 12.1428 9.46117C12.0997 9.41729 12.0657 9.36535 12.0426 9.30831L11.575 8.13924ZM8.09292 12.1392L9.26199 12.6069C9.31903 12.6299 9.38004 12.6414 9.44154 12.6409C9.50305 12.6403 9.56385 12.6277 9.62046 12.6036C9.67707 12.5796 9.72839 12.5446 9.7715 12.5008C9.8146 12.4569 9.84864 12.4049 9.87166 12.3479C9.89469 12.2909 9.90626 12.2299 9.90571 12.1683C9.90516 12.1068 9.8925 12.046 9.86846 11.9894C9.84441 11.9328 9.80945 11.8815 9.76557 11.8384C9.72169 11.7953 9.66975 11.7613 9.61271 11.7382L8.44364 11.2706C8.32845 11.2241 8.19951 11.2252 8.08518 11.2738C7.97084 11.3224 7.88048 11.4144 7.83397 11.5296C7.78746 11.6447 7.78861 11.7737 7.83718 11.888C7.88574 12.0024 7.97773 12.0927 8.09292 12.1392ZM19.6667 15.0116L18.4977 14.544C18.3825 14.4975 18.2535 14.4987 18.1392 14.5472C18.0249 14.5958 17.9345 14.6878 17.888 14.803C17.8415 14.9181 17.8426 15.0471 17.8912 15.1614C17.9398 15.2758 18.0318 15.3661 18.147 15.4126L19.316 15.8803C19.4312 15.9268 19.5602 15.9256 19.6745 15.877C19.7888 15.8285 19.8792 15.7365 19.9257 15.6213C19.9722 15.5061 19.9711 15.3772 19.9225 15.2628C19.8739 15.1485 19.7819 15.0581 19.6667 15.0116ZM15.717 17.8425C15.6705 17.7274 15.5802 17.6354 15.4658 17.5868C15.3515 17.5382 15.2225 17.5371 15.1074 17.5836C14.9922 17.6301 14.9002 17.7205 14.8516 17.8348C14.8031 17.9491 14.8019 18.0781 14.8484 18.1933L15.316 19.3623C15.3625 19.4775 15.4529 19.5695 15.5672 19.6181C15.6816 19.6666 15.8105 19.6678 15.9257 19.6213C16.0409 19.5748 16.1329 19.4844 16.1815 19.3701C16.23 19.2558 16.2312 19.1268 16.1847 19.0116L15.717 17.8425ZM20.3045 7.17592C20.2616 7.13015 20.2099 7.09348 20.1526 7.06809C20.0952 7.04271 20.0333 7.02912 19.9706 7.02813C19.9079 7.02715 19.8456 7.0388 19.7875 7.06238C19.7294 7.08596 19.6766 7.121 19.6323 7.1654L16.5687 10.229L16.2542 9.91448C16.0805 9.74056 15.8742 9.60259 15.6471 9.50846C15.42 9.41433 15.1766 9.36588 14.9308 9.36588C14.685 9.36588 14.4416 9.41433 14.2145 9.50846C13.9875 9.60259 13.7812 9.74056 13.6074 9.91448L12.602 10.9181C12.5803 10.9398 12.5631 10.9656 12.5513 10.994C12.5395 11.0224 12.5335 11.0528 12.5335 11.0835C12.5335 11.1143 12.5395 11.1447 12.5513 11.1731C12.5631 11.2015 12.5803 11.2273 12.602 11.249L16.2086 14.8532C16.2303 14.875 16.2561 14.8922 16.2845 14.904C16.3129 14.9157 16.3433 14.9218 16.3741 14.9218C16.4048 14.9218 16.4352 14.9157 16.4636 14.904C16.492 14.8922 16.5178 14.875 16.5395 14.8532L17.518 13.8747C17.8726 13.5269 18.0782 13.0549 18.0914 12.5583C18.0963 12.3073 18.0502 12.0579 17.9561 11.8251C17.862 11.5924 17.7217 11.3811 17.5437 11.204L17.2292 10.8901L20.2805 7.84054C20.3694 7.75423 20.4216 7.6369 20.4261 7.51305C20.4305 7.3892 20.387 7.26841 20.3045 7.17592ZM11.4037 11.3741C11.3594 11.3298 11.3067 11.2948 11.2486 11.2713C11.1905 11.2477 11.1283 11.2361 11.0657 11.2371C11.003 11.2381 10.9412 11.2516 10.8839 11.277C10.8266 11.3023 10.775 11.3389 10.7321 11.3846C10.6496 11.4771 10.6061 11.5979 10.6105 11.7217C10.615 11.8456 10.6671 11.9629 10.7561 12.0492L11.1132 12.4064L10.2171 13.3013C10.0395 13.4785 9.89962 13.6897 9.80579 13.9224C9.71197 14.155 9.66617 14.4043 9.67117 14.6551C9.68351 15.1515 9.88829 15.6237 10.2423 15.972L10.5345 16.2608L7.47857 19.3115C7.39235 19.3955 7.34082 19.5088 7.33422 19.629C7.32762 19.7491 7.36641 19.8674 7.44291 19.9603C7.48493 20.0091 7.53655 20.0486 7.59454 20.0765C7.65254 20.1044 7.71567 20.12 7.77997 20.1223C7.84427 20.1247 7.90837 20.1137 7.96826 20.0902C8.02814 20.0666 8.08252 20.031 8.12799 19.9855L11.191 16.9219L11.5049 17.2364C11.8565 17.5864 12.3324 17.7829 12.8285 17.7829C13.3247 17.7829 13.8006 17.5864 14.1522 17.2364L15.0489 16.3409L15.4195 16.7121C15.4629 16.7555 15.5145 16.79 15.5713 16.8135C15.6281 16.837 15.6889 16.8491 15.7503 16.8491C15.8118 16.8491 15.8726 16.837 15.9294 16.8135C15.9862 16.79 16.0378 16.7555 16.0812 16.7121C16.1246 16.6686 16.1591 16.617 16.1826 16.5603C16.2061 16.5035 16.2182 16.4426 16.2182 16.3812C16.2182 16.3198 16.2061 16.2589 16.1826 16.2022C16.1591 16.1454 16.1246 16.0938 16.0812 16.0504L11.4037 11.3741Z"
                        fill="#1FA2EC"
                      />
                    </svg>
                  </div>
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </motion.div>
  )
}

export default ManagaCamera
